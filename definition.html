<head>
    <script src="./libraries/vue.js"></script>
    <link rel="stylesheet" href="./test.css">
</head>


<div class="app">
    <div class="text">
        <transition-group class="list" tag="div" name="list">
            <span class="list-complete-item"
                v-for="(word, i) in text" 
                :key="word.key"
                @click="replaceWithDefinition(word.word, i)">
                {{word.word}}
            </span>
        </transition-group>
    </div>
</div>


<script>
let i = 0


new Vue({
    el: '.app',
    data: {
        text: addKeys(['The', 'quick', 'brown', 'fox', 'jumps', 'over', 'the', 'lazy', 'dog'])
        // text: addKeys(['Fuck', 'this'])
    },

    methods: {
        async replaceWithDefinition(word, i) {
            let def = await getDefinition(word)
            def = def.replace(/^[aA]/, '')
            def = def.replace(/\s*/, ' ')

            if (def.includes(':')) {
                def = def.split(':')[0]
            }
            

            let words = def.split(/\s+/).filter(w => w != '')
            this.text.splice(i, 1, ...addKeys(words))
        }
    }
})





async function getDefinition(word) {
    const key = '4eb52a73-003b-48e9-a88c-81d96c9b2e65'
    let response = await fetch(`https://www.dictionaryapi.com/api/v3/references/sd4/json/${word}?key=${key}`)
    let definitions = await response.json()
    return definitions[0].shortdef[0]
}


function addKeys(words) {
    return words.map(word => ({
        word,
        key: i++
    }))
}


function randomElement(array) {
    return array[Math.floor(Math.random() * array.length)]
}
</script>
