<head>
    <title>Death by Definition</title>
    <script src="./libraries/vue.js"></script>
    <link rel="stylesheet" href="style.css">
</head>


<div class="app">
    <nav>
        <a href="./showcase.html">showcase</a> <div class="sep">|</div>
        <a href="./tool.html" class="active">tool</a>
    </nav>

    <div class="text">
        <transition-group class="list" tag="div" name="list">
            <span class="list-complete-item"
                :class="{brace: word.word == ')' || word.word == '('}"
                :data-level="word.level"
                v-for="(word, i) in text" 
                :key="word.key"
                @click="addDefinition(word, i)">
                {{word.word}}
            </span>
        </transition-group>
    </div>
</div>


<script>
let i = 0


new Vue({
    el: '.app',
    data: {
        // text: makeWords('Congress shall make no law respecting an establishment of religion, or prohibiting the free exercise thereof; or abridging the freedom of speech, or of the press; or the right of the people peaceably to assemble, and to petition the Government for a redress of grievances.'.split(' '))
        text: makeWords('All human beings are born free and equal in dignity and rights. They are endowed with reason and conscience and should act towards one another in a spirit of brotherhood'.split(' ')),
        // text: makeWords('For sale are a pair of very rare Dairy Queen advertising rubber duckies. One is yellow and the other is green. The ducks are approximately 3" long. They are both in excellent, not played with condition but have been taken out of their original packaging. These came from the collection of the one time Dairy Queen franchise owner. Please review all pictures prior to your purchase.'.split(' '))
    },

    methods: {
        async addDefinition(word, i) {
            if (!word.alreadyExpanded) {
                let def = await getDefinition(word.word)

                def = def.replace(/^[aA]/, '')

                let words = def.split(/\s+/).filter(w => w != '')
                let levelDeeper = word.level + 1
                this.text = [
                    ...this.text.slice(0, i),
                    // ...makeWords(['('], levelDeeper),
                    ...makeWords(words, levelDeeper), // insert in the middle
                    // ...makeWords([')'], levelDeeper),
                    ...this.text.slice(i + 1)
                ]
            }
        }
    }
})





async function getDefinition(word) {
    const key = '4eb52a73-003b-48e9-a88c-81d96c9b2e65'
    let response = await fetch(`https://www.dictionaryapi.com/api/v3/references/sd4/json/${word}?key=${key}`)
    let definitions = await response.json()
    return definitions[0].shortdef[0]
}


function makeWords(words, level = 0) {
    return words.map(word => ({
        word,
        key: i++,
        level,
        alreadyExpanded: false
    }))
}


function randomElement(array) {
    return array[Math.floor(Math.random() * array.length)]
}

</script>
